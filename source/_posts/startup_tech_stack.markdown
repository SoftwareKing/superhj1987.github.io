---
layout: post
title: "互联网后端基础技术栈"
date: 2016-08-22 20:10:34 +0800
comments: true
categories: work
---

对于一个互联网企业，后端服务是必不可少的一个组成部分。抛开业务应用来说，往下的基础服务设施做到哪些才能够保证业务应用的稳定、可靠、可维护呢？纵观真个互联网技术体系再结合公司的目前状况，必不可少或者起到关键作用的基础技术/组件如下：

- Api网关
- Api说明文档
- 后端基础框架
- 数据库
- 搜索引擎
- 应用性能分析
- 分布式文件存储
- 离线计算
- 实时计算
- 数据即席分析
- 服务治理框架
- 单点登录系统
- 统一配置中心
- 统一认证中心
- 统一日志服务
- 统一调度中心
- 故障监控服务

## <a name='故障监控'></a>故障监控

对于面向用户的线上服务，发生故障是一件很严重的事情。因此，做好线上服务的故障检测告警是一件非常重要的事情。可以将故障监控分为以下两个层面的监控：

- 运维层面的监控：主要指的对主机的带宽、cpu、内存、硬盘、io等硬件资源的监控。这可以使用开源的nagios、cacti等开源软件进行监控。目前，市面上也有很多第三方服务能够提供对于主机资源的监控，如监控宝等。
- 业务层面的监控：是在主机资源层面以上的监控，比如业务逻辑遇到了异常等。需要业务中加入相关的监控代码，比如在异常抛出的地方，加一段日志记录。

监控还有一个关键的步骤就是告警。告警的方式有很多种：邮件、im、短信等。考虑到故障的重要性不同、告警的合理性、便于定位问题等因素，有以下建议：

- 告警日志要记录发生故障的机器id，尤其是在集群服务中，如果没有记录机器id，那么对于后续的问题定位会很困难。
- 要对告警做聚合，不要每一个故障都单独进行告警，这样会对工程师造成极大的困扰。
- 要对告警做等级划分，不能对所有告警都做同样的优先级处理。
- 使用微信做为告警软件，能够在节省短信成本的情况下，保证告警的到达率。

故障告警之后，那么最最关键的就是应对了。对于创业公司来说，24小时待命是必备的素质，当遇到告警的时候，需要尽快对故障做出反应，找到问题所在，并能在可控时间内解决问题。对于故障问题的排查，基本上都是依赖于日志的。只要日志打的合理，一般情况下是能够很快定位到问题所在的，但是如果是分布式服务，并且日志数据量特别大的情况下，如何定位日志就成为了难题。这里有几个方案：

- 建立ELK体系，便于快速搜索、定位日志。对于ELK的介绍，可以见：<https://xiequan.info/%E4%BD%BF%E7%94%A8elasticsearch-logstash-kibana%E6%90%AD%E5%BB%BA%E6%97%A5%E5%BF%97%E9%9B%86%E4%B8%AD%E5%88%86%E6%9E%90%E5%B9%B3%E5%8F%B0%E5%AE%9E%E8%B7%B5/>
- 建立染色日志机制(<https://www.zhihu.com/question/20292868>)，尤其对于微服务架构，要做好对每一个请求的整个链路的监控，能够在发生问题的时候在海量调用中快速定位并收集单个异常请求信息。此外，[Mercury:唯品会全链路应用监控系统解决方案详解](http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&mid=2653547643&idx=1&sn=c06dc9b0f59e8ae3d2f9feb734da4459&scene=1&srcid=0808MaLgymxNlsh4Z31oWKUi#rd)也是类似的思路。